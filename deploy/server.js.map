{"version":3,"file":"server.js","sources":["../src/helpers/api.js","../src/server/controllers/HomeController.js","../src/server/controllers/CollectionController.js","../src/server/controllers/SearchController.js","../src/server.js"],"sourcesContent":["// import fetch from 'node-fetch';\n\n// const baseURL = `https://www.rijksmuseum.nl/api/en/collection?key=${process.env.VITE_API_KEY}&imgonly=true`;\n\nexport const searchAll = async (q) => {\n  try {\n    const baseURL = `https://www.rijksmuseum.nl/api/en/collection?key=${process.env.VITE_API_KEY}&imgonly=true`;\n    let search = ''\n    if (q) {\n      const search = `&q=${q}`;\n    }\n    const URL = baseURL + search;\n    console.log(URL)\n    const data = await request(URL);\n    const formattedResults = await formatMuseumResults(data);\n    return data;\n  } catch (error) {\n    console.log(error);\n  } finally {\n    console.log(\"SearchDone\");\n  }\n};\n\nexport const getMuseumDataByMaker = async (q) => {\n  try {\n    const baseURL = `https://www.rijksmuseum.nl/api/en/collection?key=${process.env.VITE_API_KEY}`;\n    const maker = `&involvedMaker=${q}`;\n    const options = '&imgonly=true&ps=5&toppieces=true'\n    const URL = baseURL + maker;\n    // console.log(URL)\n    const data = await request(URL);\n    const formattedResults = await formatMuseumResults(data);\n    return formattedResults;\n  } catch (err) {\n    console.log(err);\n  } finally {\n    console.log(\"got By maker\");\n  }\n};\n\n\nexport const searchId = async (id) => {\n  const baseURL = `https://www.rijksmuseum.nl/api/en/collection/${id}/?key=${process.env.VITE_API_KEY}`;\n\n  // const URL = baseURL + search;\n  console.log(import.meta.env);\n  try {\n    const data = await request(baseURL);\n    const formattedResult = await formatMuseumResult(data.artObject);\n    // console.log(formattedResult);\n    return formattedResult;\n  } catch (error) {\n    console.log(error);\n  } finally {\n    console.log(\"Got id \");\n  }\n};\n\nconst request = async (url) => {\n  try {\n    const res = await fetch(url);\n    const data = await res.json();\n    return data;\n  } catch (err) {\n    console.log(err);\n    throw new Error(err);\n  }\n};\n\nexport const formatMuseumResults = (data) => {\n  const array = data.artObjects;\n  return array.map((d) => {\n    // const sizeScaleValue = (d) => sizeScale(sizeValue(d));\n    // const colorScaleValue = (d) => colorScale(colorValue(d));\n    // console.log(colorScaleValue);\n    return {\n      id: d.objectNumber,\n      title: d.title,\n      name: d.name,\n      headerImage: d.headerImage,\n      productionPlaces: d.productionPlaces,\n      links: d.links,\n      longTitle: d.longTitle,\n      webImage: d.webImage,\n      principalOrFirstMaker: d.principalOrFirstMaker,\n\n      // sizeScale: sizeScaleValue,\n      // colorScale: colorScaleValue,\n    };\n  });\n};\n\nexport const formatMuseumResult = (d) => {\n  // const keys = Object.keys(data.artObject)\n\n  // const sizeScaleValue = (d) => sizeScale(sizeValue(d));\n  // const colorScaleValue = (d) => colorScale(colorValue(d));\n  // console.log(colorScaleValue);\n  return {\n    id: d.objectNumber,\n    title: d.title,\n    titles: d.titles,\n    materials: d.materials,\n    description: d.description,\n    productionPlaces: d.productionPlaces,\n    longTitle: d.longTitle,\n    webImage: d.webImage,\n    principalOrFirstMaker: d.principalOrFirstMaker,\n    physicalMedium: d.physicalMedium,\n    subTitle: d.subTitle,\n    plaqueDescription: d.plaqueDescription,\n    principalMaker: d.principalMaker,\n    location: d.location,\n  };\n};\n","import express from 'express';\nimport { searchAll, getMuseumDataByMaker } from '../../helpers/api.js';\n\nconst apiKey = 'S3GLzVAr';\nconst URL = `https://www.rijksmuseum.nl/api/en/collection?key=${apiKey}&imgonly=true`;\n\n// const thisUser = req.user;\n// \tlet users = [];\n\t\n// \ttry {\n// \t\tartwork = await matchHelper.users(thisUser);\n// \t\tif (req.user) {\n// \t\t\tres.render('pages/index', {\n// \t\t\t\ttitle: 'Discover',\n// \t\t\t\tuser: req.user,\n// \t\t\t\tusers: users\n// \t\t\t});\n// \t\t} else {\n// \t\t\tres.redirect('/error');\n// \t\t}\n// \t} catch (err) {\n// \t\tnext(err);\n// \t}\nexport const HomeController = async (req,res, next) => {\n\t\n\ttry {\n\t\tconst rembrand = await getMuseumDataByMaker('Rembrandt+van+Rijn');\n\t\tconst Johannes = await getMuseumDataByMaker('Johannes+Vermeer');\n\n\t\treturn res.render('index.njk', {\n\t\t\ttitle: 'home',\n\t\t\tmakers: [{\n\t\t\t\tname: 'Rembrand',\n\t\t\t\tdata: rembrand\n\t\t\t},{\n\t\t\t\tname: 'Johannes Vermeer',\n\t\t\t\tdata: Johannes\n\t\t\t},\n\t\t]\n\t\t});\n\t} catch (err) {\n\t\tconsole.log(err)\n\t\tnext(err)\n\t}\n};\n\n\n\n\nexport default HomeController;","import { searchAll, searchId } from '../../helpers/api.js';\n\nexport const CollectionController = async (req,res, next) => {\n\t// const query = req.query.q;\n\t// console.log(query)\n\ttry {\n\t\tconst data = await searchAll('Rembrand');\n\t\treturn res.render('collection.njk', {\n\t\t\ttitle: 'Collecton',\n\t\t\tquery: 'Rembrand',\n\t\t\tdata: data\n\t\t})\n\t} catch (err) {\n\t\tconsole.log(err)\n\t\tnext(err)\n\t}\n}\n\nexport const CollectionDetailsController = async (req,res, next) => {\n  const id = req.params.id;\n\t// const query = req.query.q;\n\t// console.log(query)\n\ttry {\n\t\tconst data = await searchId(id);\n\t\treturn res.render('details.njk', {\n\t\t\ttitle: 'Collecton',\n\t\t\tdata: data\n\t\t})\n\t} catch (err) {\n\t\tconsole.log(err)\n\t\tnext(err)\n\t}\n}\n\n\nexport default CollectionController\n","import { searchAll } from '../../helpers/api.js';\n\nexport const SearchController = async (req,res, next) => {\n\tconst query = await req.query.q;\n\ttry {\n\t\t\n\t\tconsole.log(req.query)\n\t\tconst data = await searchAll(query);\n\t\t// console.log(data)\n\t\treturn res.render('search.njk', {\n\t\t\ttitle: 'Search',\n\t\t\tquery: query,\n\t\t\tdata: data\n\t\t})\n\t} catch (error) {\n\t\tnext(err)\n\t}\n}\nexport default SearchController","import express from 'express';\nimport ViteExpress from 'vite-express';\nimport bodyParser from 'body-parser';\nimport * as exphbs from 'express-handlebars';\nimport path from 'path';\nimport { fileURLToPath } from 'node:url';\nimport { HomeController } from './server/controllers/HomeController.js';\nimport { CollectionController, CollectionDetailsController } from './server/controllers/CollectionController.js';\nimport { SearchController } from './server/controllers/SearchController.js';\nimport dotenv  from \"dotenv\";\nimport logger from 'morgan';\nimport cors from 'cors';\nimport nunjucks from 'nunjucks';\nimport expressNunjucks from 'express-nunjucks';\nimport compression from 'compression';\n\n// const express = require(\"express\");\n// const ViteExpress = require(\"vite-express\");\n\ndotenv.config()\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n// const __joindirname = path.join(__filename);\n\n\nconst app = express();\n\nconst PORT = process.env.PORT || 3000;\nconst router = express.Router();\n\n\n\napp.use(logger('dev'));\napp.use(compression())\n\napp.use(/.*-[0-9a-f]{10}\\..*/, (req, res, next) => {\n  res.setHeader('Cache-Control', 'max-age=365000000, immutable');\n  next();\n});\n\n\n// app.use(express.static('./public/', {\n//   redirect:true\n// }))\n\n\n\n\n\n// const hbs = exphbs.create({\n//   defaultLayout: 'main',\n//   partialsDir: __dirname + '/views/partials/'\n// })\n\n\n// app.engine('handlebars', 'njk')\n\n\n\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({\n\textended: true\n}));\napp.use('/', express.static('src/static'));\n// app.use('/', express.static('src/public'));\n\napp.set('view engine', 'njk');\napp.set('views', path.join(__dirname, 'views'));\n\n\nconst njk = expressNunjucks(app, {\n  templateDirs: path.join(__dirname, 'views'),\n  loader: nunjucks.FileSystemLoader,\n});\n\n// app.get(\"/sw.js\", (req, res) => {\n//   res.sendFile(path.resolve(__dirname, \"public/\", \"sw.js\"));\n// });\n\napp.get(\"/\", HomeController);\napp.get(\"/:q\", SearchController);\n\napp.get(\"/collection\", CollectionController);\napp.get(\"/collection/:id\", CollectionDetailsController);\n\nViteExpress.listen(app, PORT, () => {\n  console.log(__dirname)\n  console.log(\"Server is listening on port 3000...\")\n});\n\nViteExpress.build()"],"names":["search","err"],"mappings":"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"}